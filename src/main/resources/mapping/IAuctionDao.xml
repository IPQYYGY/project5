<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.accp.exercise1.dao.IBillDao">
	<resultMap id="BaseResultMap"
		type="com.accp.exercise1.vo.BillVo">
		<id column="bill_no" property="billno" jdbcType="INTEGER" />
		<result column="bill_date" property="billdate" jdbcType="DATE" />
		<result column="customer_name" property="customername"
			jdbcType="VARCHAR" />
		<result column="sale_name" property="salename"
			jdbcType="VARCHAR" />
		<result column="goods_money_amt" property="goodsmoneyamt"
			jdbcType="FLOAT" />
		<result column="bill_remark" property="billremark"
			jdbcType="VARCHAR" />
		<result column="status_name" property="num" jdbcType="INTEGER" />
	</resultMap>
	<select id="queryList" resultMap="BaseResultMap">
		SELECT b.bill_no AS
		bill_no,bill_date,customer_name,sale_name,bill_remark,goods_money_amt,COUNT(d.bill_no)
		AS num
		FROM t_bill b INNER JOIN t_bill_detail d ON d.bill_no=b.bill_no
		GROUP BY d.bill_no
	</select>
	<delete id="deleteById">
		delete from t_bill
		where bill_no = #{billno};
		delete
		from
		t_bill_detail
		where bill_no = #{billno};
	</delete>
	<insert id="insert">
		INSERT INTO t_bill(
		bill_no,
		bill_date,
		customer_name,
		customer_address,
		sale_name,
		maker_name,
		permitter,
		permit_date,
		bill_remark
		)
		VALUES
		(#{bill.billno},#{bill.billdate,jdbcType=DATE},#{bill.customername},#{bill.customeraddress},
		#{bill.salename},#{bill.makername},#{bill.permitter},#{bill.permitdate,jdbcType=DATE},
		#{bill.billremark}
		);
		<if test="bill.detail.size()!=0">
			INSERT INTO t_bill_detail(
			bill_no,
			goods_name,
			goods_num,
			goods_price,
			goods_money_amt,
			present
			)
			VALUES
			<foreach collection="bill.detail" item="temp" separator=",">
				(#{bill.billno},#{temp.goodsname},#{temp.goodsnum},#{temp.goodsprice},#{temp.goodsmoneyamt},
				#{temp.present})
			</foreach>
			;
		</if>
	</insert>
</mapper>